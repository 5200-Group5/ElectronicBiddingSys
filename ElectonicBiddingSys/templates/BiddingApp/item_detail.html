<!DOCTYPE html>
<html lang="en">
    <head>
        {% load static %}
        <meta charset="UTF-8" />
        <title>{{ item.name }}</title>
        <link rel="stylesheet" href="{% static 'item_detail.css' %}" />
    </head>
    <body>
        <!-- Navbar -->
        <header class="custom-navbar">
            <nav class="navbar-content">
                <a href="{% url 'home' %}">Home</a>
                <a href="{% url 'bidding:bidding_page' %}">Bidding</a>
                <a href="{% url 'BiddingApp:chatbot' %}">Chatbot</a>
                <a href="{% url 'account:account' %}">My Account</a>
                {% if not request.user.is_authenticated %}
                <a href="{% url 'user:login' %}">Login</a>
                {% else %}
                <a href="{% url 'user:logout' %}"
                    >{{ request.user.username }}, Logout</a
                >
                {% endif %}
            </nav>
        </header>

        <div class="item-container">
            <!-- Back Button -->
            <a href="{% url 'bidding:bidding_page' %}" class="back-button">Back to Bidding Page</a>
            <h1>{{ item.name }}</h1>
            <img src="{{ item.image_url }}" alt="{{ item.name }}" />
            <p>{{ item.description }}</p>
            <p>Starting Bid: {{ item.starting_price }}</p>
            <p>Start date: {{ item.start_date }}</p>
            <p>End date: {{ item.end_date }}</p>

            <h2>Place Your Bid</h2>
            <form
                method="post"
                action="{% url 'bidding:item_detail' item_id=item.item_id %}"
            >
                {% csrf_token %}
                <label for="bid_price">Your Bid:</label>
                <input
                    type="number"
                    id="bid_price"
                    name="bid_price"
                    min="{{ item.starting_price }}"
                    required
                />
                <button type="submit">Place Bid</button>
            </form>
            {% if error_message %}
            <div class="alert alert-danger" role="alert">
                {{ error_message }}
            </div>
            {% endif %}
            <h2>Current Bids</h2>
            <ul>
                {% for bid in bids %}
                <li>
                    <a href="{% url 'bidding:user_profile' username=bid.user.username %}">{{ bid.user.username }}</a>: {{ bid.price }}
                </li>
                {% empty %}
                <li>No bids yet.</li>
                {% endfor %}
            </ul>
            <h2>Winner:</h2>
            {% if item.end_date <= current_time and bids %}
            <p>The winner is: {{ bids.0.user.username }}</p>
            {% else %}
            <p>No winner yet.</p>
            {% endif %}
        </div>
    </body>
</html>
